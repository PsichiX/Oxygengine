<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Hardware Accelerated rendering - Oxygengine Essentials Book</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../cli/introduction.html"><strong aria-hidden="true">2.</strong> Oxygengine Ignite CLI tool</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../cli/new-project.html"><strong aria-hidden="true">2.1.</strong> Creating new project</a></li><li class="chapter-item expanded "><a href="../../cli/build-project.html"><strong aria-hidden="true">2.2.</strong> Building your project</a></li><li class="chapter-item expanded "><a href="../../cli/update.html"><strong aria-hidden="true">2.3.</strong> Update engine version used in your game project</a></li><li class="chapter-item expanded "><a href="../../cli/faster-compilation-times.html"><strong aria-hidden="true">2.4.</strong> Speed up compilation times for new projects</a></li><li class="chapter-item expanded "><a href="../../cli/asset-pipeline.html"><strong aria-hidden="true">2.5.</strong> Asset pipeline and its tools</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Concepts explained</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../concepts/ha-renderer/introduction.html" class="active"><strong aria-hidden="true">3.1.</strong> Hardware Accelerated rendering</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../concepts/ha-renderer/render-pipeline.html"><strong aria-hidden="true">3.1.1.</strong> Render Pipeline</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.2.</strong> Camera</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.3.</strong> Render Target</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.4.</strong> Image</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.5.</strong> Virtual Image</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.6.</strong> Mesh</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.7.</strong> Virtual Mesh</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.8.</strong> Material</div></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Tutorials</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">4.1.</strong> RPG game using Overworld module</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.</strong> VN game using Visual Novel module</div></li></ol></li><li class="chapter-item expanded "><a href="../../more.html"><strong aria-hidden="true">5.</strong> More...</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Oxygengine Essentials Book</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="hardware-accelerated-rendering"><a class="header" href="#hardware-accelerated-rendering">Hardware Accelerated rendering</a></h1>
<p>Here we will take a deeper look at how Oxygengine's hardware Accelerated rendering model works.</p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>HA renderer uses completely data-driven, material-graph based rendering approach.
The most important unit in HA renderer is Render Pipeline.</p>
<ul>
<li>Render Pipelines are containers for Render Targets and Render Stages.</li>
<li>Render Targets are a GPU storage, more precisely dynamic textures that all
rendered information gets stored into.</li>
<li>Render Stages are containers for Render Queues and are used by dedicated render
systems which define how entities (or any custom data in mater of fact) gets
rendered into Render Target that Render Stage points to.</li>
<li>Render systems work on cameras and record Render Commands into Render Queue
assigned to given Render Stage.</li>
<li>Render Stage also defines Material Domain (which is basically a shader backend)
that will be linked with Material Graphs (which are shader frontends) of
entities that gets rendered (more about how Materials works later on this page).</li>
</ul>
<h2 id="material-graph-based-rendering"><a class="header" href="#material-graph-based-rendering">Material-graph based rendering</a></h2>
<p>While most game engines expose raw shaders to the users to make them tell exactly
how anything should be rendered, Oxygengine took another path and do not expose
any shader code, these are considered engine internals that user should never be
forced to write on their own. More than that, shaders gets baked at runtime (or
build-time, both material graphs and baked materials are assets) only when engine
finds that certain pair of material domain (backend) and material graph (frontend)
are gonna be used in rendering.</p>
<p>Material domain and material graphs always work in tandem, material domain job is to preprocess vertex and uniform data and send it to material graph (via specific interface that given domain defines) for it to post process that data and send it back for material domain to store it properly in target outputs.</p>
<p>The reason for them being separate units is because HA renderer aims for in case
of user wanting to do some different visuals than default ones provided by the
engine, to focus only on the effect and don't bother writing additional logic just
to meet specialized vertex format and render target requirements. Another benefit
we get from this approach is that now user can make his frontend material once and
renderer will bake at runtime all variants needed all pairs of domain and graph
materials. This basically means that user can now get his material graph working
without any additional work with any vertex format and target format that renderer
find compatible at runtime. In even simpler words: imagine you have a material
graph that has to add outlines to the image, in that case no matter if you render
your entity for example in forward or deferred renderer, it will work for both by
default as long as both use material domains which provide domain node that your
outline material uses.</p>
<p><strong>IMPORTANT:</strong> all shader variants for given material are considered unique as
long as they have different Material Signatures:</p>
<ul>
<li>Material Signature is defined by Material Mesh Signature + Material Render
Target Signature + Domain name</li>
<li>Material Mesh Signature is defined by unique Vertex Layout (vertex layouts are
defined by meshes, to be more precise by the vertex format given mesh data uses)</li>
<li>Material Render Target Signature is defined by set of render target output
names.</li>
</ul>
<h2 id="1-picture-say-more-than-1000-words"><a class="header" href="#1-picture-say-more-than-1000-words">1 picture say more than 1000 words</a></h2>
<p>Let's take a look at the simplest material domain (this is code-side
representation of the material domain/graph):</p>
<pre><code class="language-rust ignore">material_graph! {
    inputs {
        [fragment] domain BaseColor: vec4 = {vec4(1.0, 1.0, 1.0, 1.0)};

        [vertex] uniform model: mat4;
        [vertex] uniform view: mat4;
        [vertex] uniform projection: mat4;

        [vertex] in position: vec3 = vec3(0.0, 0.0, 0.0);
        [vertex] in color: vec4 = vec4(1.0, 1.0, 1.0, 1.0);
    }

    outputs {
        [vertex] domain TintColor: vec4;
        [vertex] domain ScreenPosition: vec4;

        [vertex] builtin gl_Position: vec4;
        [fragment] out finalColor: vec4;
    }

    [model_view_projection = (mul_mat4,
      a: projection,
      b: (mul_mat4,
        a: view,
        b: model
      )
    )]
    [pos = (append_vec4, a: position, b: {1.0})]
    [screen_position = (mul_mat4_vec4, a: model_view_projection, b: pos)]

    [color -&gt; TintColor]
    [screen_position -&gt; ScreenPosition]
    [screen_position -&gt; gl_Position]
    [BaseColor -&gt; finalColor]
}
</code></pre>
<p>In this snippet we can see that this particular material domain expects model +
view + projection uniforms, as well as position + color vertex inputs, and it
writes data to gl_Position vertex output and finalColor target output. This
basically means that this material domain will work with stage that writes to
finalColor target output and position + color vertex format. It also will bake
shader variants for any material graph that <strong>might read</strong> TintColor and/or
ScreenPosition domain input, and <strong>might write</strong> BaseColor domain output.</p>
<p>Consider domain input/outputs to be purely an optional interface between material
domain and material graph. You might ask now: &quot;why domain interface is
optional?&quot; - well, this is where this approach shines too: you see, when material
domain  gets combined with material graph, it will bake shader only from nodes
that leads  directly from target outputs to vertex inputs, with all required
nodes along the way.</p>
<p>Now let's take a look at the simplest material graph:</p>
<pre><code class="language-rust ignore">material_graph! {
    inputs {
        [vertex] domain TintColor: vec4 = {vec4(1.0, 1.0, 1.0, 1.0)};
    }

    outputs {
        [fragment] domain BaseColor: vec4;
    }

    [[TintColor =&gt; vColor] -&gt; BaseColor]
}
</code></pre>
<p>Here in this material graph we can see we only use domain interface and just move input color from vertex shader stage to fragment shader stage and send it back to material domain to let it store properly for its render target outputs - when user is making material graph, he doesn't have to care about how to write to targets, he can only care how to process domain inputs into domain outputs and domain takes care of properly storing data into target outputs.</p>
<p>Now imagine user wants to create material graph that do not use TintColor at all,
rather converts ScreenPosition into BaseColor:</p>
<pre><code class="language-rust ignore">material_graph! {
    inputs {
        [vertex] domain ScreenPosition: vec4 = {vec4(0.0, 0.0, 0.0, 0.0)};
    }

    outputs {
        [fragment] domain BaseColor: vec4;
    }

    [[ScreenPosition =&gt; vColor] -&gt; BaseColor]
}
</code></pre>
<p>This material graph when combined with our previously defined material domain,
will bake shader with nodes that only use screen position calculated in domain
graph and not include color vertex data in the shader at all since this shader
variant does not use it. Now, do you also see the benefits of this over usual
<code>#ifdef</code>-ed raw shaders?</p>
<hr />
<p>As you can see, all of this moves away a burden of careful producing of all
shader code from user to the engine. With materials there is no more need for any
tedious, boilerplate-y and unnecessary <code>#ifdef</code>-ed shader code - we have reduced
the complexity of shader creation and management.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../cli/asset-pipeline.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../concepts/ha-renderer/render-pipeline.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../cli/asset-pipeline.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../concepts/ha-renderer/render-pipeline.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
